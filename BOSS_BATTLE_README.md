# Boss战斗功能说明

## 功能概述

本项目新增了与Boss战斗的新窗口功能。当玩家在迷宫中走到Boss位置时，会自动进入专门的战斗界面，进行策略性的对战操作。

## 功能特性

### 1. 自动触发战斗
- 当玩家移动到迷宫中的Boss位置时，自动弹出战斗窗口
- 支持手动模式和AI自动模式下的Boss战斗

### 2. 战斗界面
- **独立的战斗窗口**：800x750像素的专用战斗界面
- **Boss信息显示**：显示Boss血量和玩家资源
- **战斗区域**：可视化的战斗场景，包含Boss和玩家图标
- **血量条显示**：实时显示Boss血量和玩家资源条

### 3. 战斗策略选择
- **最优策略**：使用分支限界算法找到最佳战斗序列
- **随机策略**：生成多个随机策略并选择最佳方案
- **策略说明**：显示当前选择策略的详细说明

### 4. 交互控制
- **键盘控制**：
  - `1`：选择最优策略
  - `2`：选择随机策略
  - `空格`：开始战斗
  - `L`：显示/隐藏战斗日志
  - `ESC`：退出战斗
- **鼠标控制**：点击按钮选择策略和开始战斗

### 5. 战斗日志
- 详细的战斗过程记录
- 显示每回合的技能使用、伤害、剩余血量等信息
- 支持查看历史战斗记录

## 技术实现

### 核心文件
- `src/ui/battle_ui.py`：Boss战斗UI界面
- `src/algorithms/boss_strategy.py`：Boss战斗策略算法
- `src/game_engine.py`：游戏引擎中的战斗逻辑
- `src/ui/game_ui.py`：主游戏UI中的战斗触发逻辑

### 算法特性
- **分支限界算法**：用于找到最优战斗策略
- **状态空间搜索**：探索不同的战斗状态组合
- **剪枝优化**：通过多种条件剪枝提高搜索效率
- **策略比较**：比较不同策略的效果

### 技能系统
- **普通攻击**：基础伤害，无消耗
- **大招**：高伤害，消耗资源，有冷却时间
- **治疗**：恢复资源，消耗资源
- **增益**：提升下次攻击伤害

## 使用方法

### 手动模式
1. 在迷宫中移动，遇到Boss位置
2. 自动弹出战斗窗口
3. 选择战斗策略（最优或随机）
4. 点击"开始战斗"或按空格键
5. 查看战斗结果和奖励

### AI自动模式
1. 开启自动游戏模式（按`A`键）
2. AI会自动处理Boss战斗
3. 使用最优策略进行战斗
4. 显示战斗结果

## 测试

运行测试脚本验证功能：
```bash
python test_boss_battle.py
```

## 配置参数

在`src/config.py`中可以调整以下参数：
- `BOSS_HP`：Boss初始血量（默认50）
- `NORMAL_ATTACK_DAMAGE`：普通攻击伤害（默认5）
- `SPECIAL_ATTACK_DAMAGE`：大招伤害（默认10）
- `SPECIAL_ATTACK_COOLDOWN`：大招冷却回合数（默认2）

## 界面截图说明

战斗界面包含以下区域：
1. **标题栏**：显示"Boss战斗"标题
2. **信息栏**：显示Boss血量和玩家资源
3. **战斗区域**：Boss和玩家的可视化显示
4. **控制面板**：策略选择和战斗按钮
5. **战斗日志**：详细的战斗过程记录（可选显示）

## 扩展性

该战斗系统具有良好的扩展性：
- 可以轻松添加新的技能类型
- 支持不同的Boss类型和特性
- 可以扩展更复杂的战斗机制
- 支持多人战斗模式

## 注意事项

1. 战斗窗口是独立的，关闭后会返回主游戏界面
2. AI模式下的Boss战斗不会显示战斗界面，直接执行
3. 战斗结果会影响玩家的资源数量
4. 击败Boss后会获得额外的资源奖励 