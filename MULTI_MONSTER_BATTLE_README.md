# 多怪物战斗系统

## 概述

多怪物战斗系统是对原有Boss战斗系统的扩展，支持同时与多个怪物进行战斗，并允许玩家选择攻击目标。该系统采用回合制战斗机制，提供了丰富的战术选择和策略深度。

## 主要功能

### 1. 多怪物同时战斗
- 支持同时与2-4个不同类型的怪物战斗
- 每个怪物都有独立的生命值、攻击力和防御力
- 怪物死亡后不再参与战斗

### 2. 目标选择系统
- 攻击技能需要选择具体的攻击目标
- 直观的图形界面显示所有怪物状态
- AI智能推荐最优攻击目标

### 3. 多种怪物类型
- **哥布林**: 血量25，攻击6，防御1 - 速度快但较弱
- **兽人**: 血量40，攻击10，防御2 - 攻防平衡
- **骷髅战士**: 血量30，攻击8，防御0 - 攻击力强但无防御
- **巨魔**: 血量60，攻击12，防御3 - 血厚攻击高但行动慢

### 4. 战斗场景配置
- **简单战斗**: 2个哥布林
- **中等战斗**: 哥布林 + 兽人 + 骷髅战士
- **困难战斗**: 2个兽人 + 巨魔
- **噩梦战斗**: 骷髅战士 + 兽人 + 巨魔 + 哥布林

### 5. 技能系统
- **普通攻击**: 造成5点伤害，无消耗，无冷却
- **强力一击**: 造成12点伤害，消耗10资源，冷却2回合
- **治疗**: 恢复25点生命值，消耗15资源，冷却3回合

## 系统架构

### 核心类

#### Monster类
```python
@dataclass
class Monster:
    id: int              # 怪物唯一标识
    name: str           # 怪物名称
    max_hp: int         # 最大生命值
    current_hp: int     # 当前生命值
    attack_damage: int  # 攻击伤害
    defense: int        # 防御力
    alive: bool         # 存活状态
```

#### MultiMonsterBattle类
- 管理整个多怪物战斗流程
- 处理玩家和怪物的回合行动
- 维护战斗状态和日志
- 提供AI建议和战斗结果

#### MultiMonsterBattleUI类
- 提供图形化的战斗界面
- 支持鼠标点击选择技能和目标
- 实时显示战斗状态和动画效果
- 处理用户交互和事件

### 游戏引擎集成

游戏引擎(`GameEngine`)新增了以下方法：
- `start_multi_monster_battle()`: 开始多怪物战斗
- `get_multi_battle_state()`: 获取战斗状态
- `execute_multi_battle_turn()`: 执行战斗回合
- `get_multi_battle_target_suggestion()`: 获取AI目标建议

## 使用方法

### 1. 运行主程序
```bash
python main.py
```

选择"2. 多怪物战斗测试"进入多怪物战斗模式。

### 2. 独立测试
```bash
python test_multi_monster_battle.py
```

提供控制台和图形界面两种测试方式。

### 3. 战斗流程

1. **选择战斗场景**: 从简单到噩梦四种难度
2. **查看战斗状态**: 玩家和怪物的生命值、资源等
3. **选择技能**: 点击技能按钮选择要使用的技能
4. **选择目标**: 对于攻击技能，需要选择攻击的怪物
5. **执行回合**: 玩家行动后，所有存活怪物依次行动
6. **重复战斗**: 直到所有怪物被击败或玩家被击败

### 4. 操作说明

#### 图形界面操作
- **鼠标左键**: 选择技能和目标
- **ESC键**: 取消当前选择或退出战斗
- **确认按钮**: 确认攻击目标
- **取消按钮**: 取消目标选择

#### 界面布局
- **左上角**: 战斗日志显示最近的战斗事件
- **左中部**: 技能列表，显示可用性和冷却状态
- **左下部**: 玩家状态，包括生命值和资源
- **右侧**: 怪物列表，显示每个怪物的详细状态
- **底部**: 目标选择区域（攻击时显示）

## 战术策略

### 1. 目标优先级
- **优先击杀低血量怪物**: 减少敌方总输出
- **优先攻击高攻击力怪物**: 降低受到的伤害
- **考虑防御力**: 对高防御怪物使用强力一击

### 2. 资源管理
- **合理使用强力一击**: 在关键时刻造成高伤害
- **及时治疗**: 保持生命值在安全范围
- **预留资源**: 为后续回合保留必要的资源

### 3. 技能搭配
- **普通攻击**: 用于清理残血怪物
- **强力一击**: 用于快速击杀威胁较大的怪物
- **治疗**: 在生命值较低时使用

## 技术特性

### 1. 模块化设计
- 战斗逻辑与UI界面分离
- 怪物类型和场景配置化
- 易于扩展新的怪物类型和技能

### 2. 智能AI建议
- 基于怪物血量的目标推荐
- 可扩展为更复杂的策略算法
- 帮助新手玩家学习战术

### 3. 丰富的反馈
- 实时战斗日志
- 视觉化的血量条
- 清晰的状态指示

### 4. 错误处理
- 完善的输入验证
- 异常情况的优雅处理
- 用户友好的错误提示

## 配置文件

### 怪物类型配置 (config.py)
```python
MONSTER_TYPES = {
    'goblin': {
        'name': '哥布林',
        'hp': 25,
        'attack': 6,
        'defense': 1
    },
    # ... 其他怪物类型
}
```

### 战斗场景配置
```python
MULTI_BATTLE_SCENARIOS = {
    'easy': {
        'name': '简单战斗',
        'monsters': ['goblin', 'goblin']
    },
    # ... 其他场景
}
```

## 扩展性

### 1. 添加新怪物类型
1. 在`Config.MONSTER_TYPES`中添加新的怪物配置
2. 可选择性地添加特殊能力和AI行为

### 2. 添加新技能
1. 在`Config.SKILLS`中添加技能配置
2. 在战斗逻辑中实现技能效果

### 3. 添加新战斗场景
1. 在`Config.MULTI_BATTLE_SCENARIOS`中添加场景配置
2. 指定参与战斗的怪物组合

### 4. 增强AI策略
1. 扩展`get_optimal_target_suggestion()`方法
2. 实现更复杂的目标选择算法
3. 添加怪物的智能行为

## 性能优化

- 高效的状态管理和更新
- 优化的图形渲染
- 合理的内存使用
- 流畅的用户交互体验

## 未来改进方向

1. **更多怪物类型**: 添加具有特殊能力的怪物
2. **技能树系统**: 允许玩家学习和升级技能
3. **装备系统**: 提供武器和防具来增强战斗能力
4. **战斗动画**: 添加更丰富的视觉效果
5. **多人战斗**: 支持团队vs多怪物的战斗模式
6. **战斗回放**: 记录和回放精彩的战斗过程

## 总结

多怪物战斗系统为游戏增加了丰富的战术深度和策略选择。通过目标选择机制，玩家需要在每个回合仔细考虑攻击哪个怪物，如何分配资源，以及何时使用特殊技能。这个系统不仅提供了更具挑战性的游戏体验，也为后续的功能扩展奠定了坚实的基础。